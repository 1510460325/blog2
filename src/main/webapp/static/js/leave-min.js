function leave(){queryCount();nowpag=1;queryNowPage()}function queryNowPage(){var a="?start="+nowpag+"&rows=10&t="+Math.random();$.ajax({url:encodeURI("/blog2/leave/queryByCondition.do"+a),type:"GET",async:false,dataType:"json",cache:false,success:function(c){maxrows=c.total;$("#center").html("");var e=c.data;for(var d=0;d<maxrows;++d){var b=$("<p data-scroll-reveal='enter right over 0.5s'></p>");b.append(addmessage("陌生人"+(d+1),e[d].content,e[d].addtime));$("#center").append(b)}addSendDiv();loadMessageForm();var b=$("<div style='text-align: center' class=\"pagec\" id=\"pagearea\" data-scroll-reveal='enter right over 0.5s'></div>");b.append('<ul class="pagination"></ul>');$("#center").append(b);$(".pagination").createPage({totalPage:maxpage,currPage:nowpag,backFn:function(f){if(nowpag==f){return}nowpag=f;queryNowPage()}});if(c.online_num){$("#online").html(c.online_num+"人")}reset()},error:function(b){console.log(b)}})}function loadMessageForm(){$("#center").append('<div style="padding-left: 35%; "><form class="bs-example bs-example-form" role="form" id=\'commentform\'>\n                    <div class="input-group">\n                        <span class="input-group-addon">留言区</span>\n                        <textarea id=\'words\' placeholder=\'输入留言\' style="width:185px;margin-right: 50px;" class="form-control" rows="2"></textarea>\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">验证码</span>\n                        <input id=\'userStr\' type="text" class="form-control" placeholder="验证码" style="width:100px;margin-right: 20px;">\n                        <img id=\'userimg\' onclick=\'changeImg()\' src=\'/blog2/pic/getPic.do\' style=\'border-radius: 2px;vertical-align:middle;\'>\n                    </div>\n                    <br>\n                    <div style=\'display: flex;\'>\n                        <div id=\'warning\' style="width:120px; height: 34px;" ></div>\n                        <button type="reset" class="btn btn-info" style="margin-right:25px;">重置</button>\n                        <button type="button" onclick=\'leaveMessage()\' class="btn btn-info">留言</button>\n                    </div>\n                </form></div>');changeImg();$("#commentform").slideToggle("slow")}function addmessage(a,b,c){return'<img src="/blog2/static/img/user.png" style="height: 25px; width: 25px">\n                <span class="user"> '+a+' </span>\n<br/><br/><br/>                <p class="cons">'+addNbsp(7)+b.replace(/&/g,"&amp").replace(/</g,"&lt").replace(/>/g,"&gt")+'                <span class="glyphicon glyphicon-time"></span>\n                <span class="commentTime"> '+longToTime(c)+"</span>\n                </p>"}function leaveMessage(){var a=$("#words").val();var c=$("#userStr").val();if(a.length>250){lerDiv("字数太多了");return}if(a.length==0||a.trim()==""){lerDiv("请输入文字");return}if(c.length==0||c.trim()==""){lerDiv("输入验证码");return}var b="?content="+a+"&userstr="+c+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/leave/addLeaveMessage.do"+b),type:"GET",async:false,dataType:"json",cache:false,success:function(d){if(d.data[0]==false){lerDiv("验证码错误");changeImg()}if(d.data[0]==true){leave()}if(d.online_num){$("#online").html(d.online_num+"人")}},error:function(d){console.log(d)}})}function addSendDiv(){$("#center").append('<ul class="pager">\n\t<li class="center-block"><a onclick=\'commentForm()\'><label>我要留言</label></a></li>\n</ul>')}function addNbsp(c){var a="";for(var b=0;b<c;b++){a+="&nbsp;"}return a}function queryCount(){var a="?t="+Math.random();$.ajax({url:encodeURI("/blog2/leave/queryCount.do"+a),type:"GET",async:false,dataType:"json",cache:false,success:function(b){maxpage=Math.floor(b.data[0]/10)+1;if(b.online_num){$("#online").html(b.online_num+"人")}},error:function(b){console.log(b)}})}function login(){$.ajax({url:encodeURI("/blog2/user/checkOnline.do?t="+Math.random()),type:"GET",async:true,dataType:"json",cache:false,success:function(a){if(a.total==0){loginForm()}else{$("#center").html("");$("#center").html('<table class="table">\n                <caption>用户信息</caption>\n                <tbody>\n                <tr>\n                    <td>帐号</td>\n                    <td>'+a.data[0].username+"</td>\n                </tr>\n                <tr>\n                    <td>个性签名</td>\n                    <td>"+a.data[0].content+'</td>\n                </tr>\n                <tr>\n                    <td></td>\n                    <td>\n                        <button type="button" onclick=\'exitUser()\' class="btn btn-info">注销</button>\n                    </td>\n                </tr>\n                </tbody>\n            </table>')}},error:function(a){console.log(a)}})}function exitUser(){$.ajax({url:encodeURI("/blog2/user/exit.do?t="+Math.random()),type:"GET",async:false,dataType:"json",cache:false,success:function(a){login()},error:function(a){console.log(a)}})}function loginForm(){$("#center").html('<div style="padding-left: 35%; ">\n                <form class="bs-example bs-example-form" role="form">\n                    <div class="input-group">\n                        <span class="input-group-addon">帐 号</span>\n                        <input id=\'username\' type="text" style="width:200px;margin-right: 50px;" class="form-control" placeholder="username">\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">密 码</span>\n                        <input id=\'password\' type="password" style="width:200px;margin-right: 50px;" class="form-control" placeholder="password">\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">验证码</span>\n                        <input id=\'userStr\' type="text" class="form-control" placeholder="验证码" style="width:100px;margin-right: 20px;">\n                        <img id=\'userimg\' onclick=\'changeImg()\' src=\'/blog2/pic/getPic.do\' style=\'border-radius: 2px;vertical-align:middle;\'>\n                    </div>\n                    <br>\n                    <div style=\'display: flex;\'>\n                        <div id=\'warning\' style="width:120px; height: 34px;" ></div>\n                        <button type="reset" class="btn btn-info" style="margin-right:20px;">重置</button>\n                        <button type="button" onclick=\'toLogin()\' class="btn btn-info">登录</button>\n                    </div>\n                </form>\n            </div>');changeImg()}function toLogin(){var d=$("#username").val();var b=$("#password").val();var a=$("#userStr").val();if(d==null||d.trim()==""){lerDiv("请输入帐号");return}if(b==null||b.trim()==""){lerDiv("请输入密码");return}if(a==null||a.trim()==""){lerDiv("输入验证码");return}var c="?username="+d+"&password="+b+"&str="+a+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/user/login.do"+c),type:"GET",async:false,dataType:"json",cache:false,success:function(e){if(e.online_num){$("#online").html(e.online_num+"人")}if(e.data[0]==0){lerDiv("用户不存在");changeImg();return}if(e.data[0]==2){lerDiv("密码错误");changeImg();return}if(e.data[0]==3){lerDiv("验证码错误");changeImg();return}login();changeImg()},error:function(e){console.log(e)}})}function regForm(){$("#center").html('<div style="padding-left: 35%; ">\n                <form class="bs-example bs-example-form" role="form">\n                    <div class="input-group">\n                        <span class="input-group-addon">帐 号</span>\n                        <input id=\'username\' type="text" style="width:200px;margin-right: 50px;" class="form-control" placeholder="username">\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">密 码</span>\n                        <input id=\'password\' type="password" style="width:200px;margin-right: 50px;" class="form-control" placeholder="password">\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon" >签 名</span>\n                        <input id=\'userContent\' type="text" style="width:200px;margin-right: 25px;" class="form-control" placeholder="个性签名">\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">验证码</span>\n                        <input id=\'userStr\' type="text" class="form-control" placeholder="验证码" style="width:100px;margin-right: 20px;">\n                        <img id=\'userimg\' onclick=\'changeImg()\' src=\'/blog2/pic/getPic.do\' style=\'border-radius: 2px;vertical-align:middle;\'>\n                    </div>\n                    <br>\n                    <div style=\'display: flex;\'>\n                        <div id=\'warning\' style="width:120px; height: 34px;" ></div>\n                        <button type="reset" class="btn btn-info" style="margin-right:20px;">重置</button>\n                        <button type="button" onclick=\'toreg()\' class="btn btn-info">注册</button>\n                    </div>\n                </form>\n            </div>');changeImg()}function toreg(){var e=$("#username").val();var c=$("#password").val();var b=$("#userContent").val();var a=$("#userStr").val();if(e==null||e.trim()==""){lerDiv("请输入帐号");return}if(c==null||c.trim()==""){lerDiv("请输入密码");return}if(b==null||b.trim()==""){lerDiv("请输入签名");return}if(a==null||a.trim()==""){lerDiv("输入验证码");return}var d="?username="+e+"&password="+c+"&content="+b+"&str="+a+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/user/reg.do"+d),type:"GET",async:false,dataType:"json",cache:false,success:function(f){if(f.online_num){$("#online").html(f.online_num+"人")}if(f.data[0]==0){lerDiv("用户已注册");changeImg();return}if(f.data[0]==2){lerDiv("验证码错误");changeImg();return}loginForm();changeImg()},error:function(f){console.log(f)}})};