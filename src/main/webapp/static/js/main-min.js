var maxpage=1;var maxrows=10;var nowtag="-";var nowpag=1;var nowBlogIndex;var runstart=0;var dataOfNowPage;var topinfo;$(document).ready(function(){loadBlogInfo();loadTags();$("#tags").slideToggle("slow");setInterval(displayTime,1000);queryCountByCondition();weblog();$("#blog").click(function(){nowtag="-";nowpag=1;queryCountByCondition()});$("#about").click(function(){$("#center").html(topinfo)});$("#say").click(function(){leave()});$("#tag").click(function(){$("#tags").slideToggle("slow")});$("#login").click(function(){login()});$("#reg").click(function(){regForm()})});function weblog(){$.ajax({url:encodeURI("/blog2/user/log.do?t="+Math.random()),type:"GET",async:true,dataType:"json",cache:false,success:function(a){},error:function(a){console.log(a)}})}function loadBlogInfo(){$.ajax({url:encodeURI("/blog2/blog/getInfo.do?t="+Math.random()),type:"GET",async:true,dataType:"json",cache:false,success:function(a){topinfo=a.data[0].top_info;$("#total").html(a.data[0].lookNum+"人");var c=new Date().getTime();runstart=a.data[0].start;var d=c-runstart;var b=ToTime(d);$("#time").html(b);if(a.online_num!=null){$("#online").html(a.online_num+"人")}},error:function(a){console.log(a)}})}function loadTags(){$.ajax({url:encodeURI("/blog2/blog/getAllTags.do?t="+Math.random()),type:"GET",async:true,dataType:"json",cache:false,success:function(b){$("#tags").html("");for(var c=0;c<b.total;++c){var a=$("<a href='#'></a>");a.click(function(){nowtag=this.innerHTML;nowpag=1;queryCountByCondition()});a.html(b.data[c].tagName);$("#tags").append("<br/>",a,"<br/>")}if(b.online_num!=null){$("#online").html(b.online_num+"人")}},error:function(a){console.log(a)}})}function displayTime(){var b=new Date().getTime();var c=b-runstart;var a=ToTime(c);$("#time").html(a)}function queryCountByCondition(){if(nowtag!="-"){var a="?tag="+nowtag+"&t="+Math.random()}else{var a="?t="+Math.random()}$.ajax({url:encodeURI("/blog2/blog/queryCountByCondition.do"+a),type:"GET",async:false,dataType:"json",cache:false,success:function(b){maxpage=Math.floor(b.data[0]/10)+1;if(b.online_num){$("#online").html(b.online_num+"人")}},error:function(b){console.log(b)}});queryByCondition()}function queryByCondition(){if(nowtag!="-"){var a="?start="+nowpag+"&rows=10&tag="+nowtag+"&t="+Math.random()}else{var a="?start="+nowpag+"&rows=10&t="+Math.random()}$.ajax({url:encodeURI("/blog2/blog/queryByCondition.do"+a),type:"GET",async:false,dataType:"json",cache:false,success:function(d){dataOfNowPage=new Array(d.total);maxrows=d.total;$("#center").html("<br/>");for(var c=0;c<d.total;c++){dataOfNowPage[c]=d.data[c].id;var b=$("<div class='article' data-scroll-reveal='enter right over 0.5s'></div>");var e=$("<p class='title'></p>");e.html(addNbsp(2)+d.data[c].title);e.attr("id",c);b.append(e);b.append(d.data[c].blog_content);b.append(addbottom(d.data[c].writetime,d.data[c].tag,d.data[c].lookNum,d.data[c].commentNum));e.click(function(){lookContent(this.id)});$("#center").append(b)}var b=$("<div style='text-align: center' data-scroll-reveal='enter right over 0.5s'></div>");b.append('<ul class="pagination"></ul>');$("#center").append(b);$(".pagination").createPage({totalPage:maxpage,currPage:nowpag,backFn:function(f){if(nowpag==f){return}nowpag=f;queryCountByCondition()}});if(d.online_num){$("#online").html(d.online_num+"人")}reset()},error:function(b){console.log(b)}})}function lookContent(a){nowBlogIndex=a;var b="?id="+dataOfNowPage[a]+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/blog/queryById.do"+b),type:"GET",async:true,dataType:"json",cache:false,success:function(d){$("#center").html('<br/><ul class="pagination">\n\t<li style="vertical-align:middle;"><a href="#" onclick=\'queryByCondition()\'>&laquo;返回</a></li>\n</ul>');var c=$("<div style='text-align: center' data-scroll-reveal='enter right over 0.5s'></div>");var e=$("<p class='title'></p>");e.html(""+d.data[0].title);c.append(e,addbottom(d.data[0].writetime,d.data[0].tag,d.data[0].lookNum,d.data[0].commentNum));$("#center").append(c);$("#center").append(d.data[0].blog_content);$("#center").append(addNextAndpre());$("#comment").click(function(){$("#comments").slideToggle("slow")});loadCommentForm();loadComments();uParse("#center",{rootPath:"../ueditor"});reset()},error:function(c){console.log(c)}})}function loadCommentForm(){$("#center").append('<div style="padding-left: 35%; "><form class="bs-example bs-example-form" role="form" id=\'commentform\'>\n                    <div class="input-group">\n                        <span class="input-group-addon">评论区</span>\n                        <textarea id=\'words\' placeholder=\'输入评论\' style="width:185px;margin-right: 50px;" class="form-control" rows="2"></textarea>\n                    </div>\n                    <br>\n                    <div class="input-group">\n                        <span class="input-group-addon">验证码</span>\n                        <input id=\'userstr\' type="text" class="form-control" placeholder="验证码" style="width:100px;">\n                        <img id=\'userimg\' onclick=\'changeImg()\' src=\'/blog2/pic/getPic.do\' style=\'border-radius: 2px;margin-left: 20px;vertical-align:middle;\'>\n                    </div>\n                    <br>\n                    <div style=\'display: flex;\'>\n                        <div id=\'warning\' style="width:120px; height: 34px;" ></div>\n                        <button type="reset" class="btn btn-info" style="margin-right:25px;">重置</button>\n                        <button type="button" onclick=\'comment()\' class="btn btn-info">留言</button>\n                    </div>\n                </form></div>');changeImg();$("#commentform").slideToggle("slow")}function changeImg(){$("#userimg").attr("src","/blog2/pic/getPic.do?t="+Math.random())}function comment(){var b=dataOfNowPage[nowBlogIndex];var a=$("#words").val();var d=$("#userstr").val();if(a.length>250){lerDiv("字数太多了");return}if(a.length==0||a.trim()==""){lerDiv("请输入文字");return}if(d.length==0||d.trim()==""){lerDiv("输入验证码");return}var c="?blogId="+b+"&content="+a+"&str="+d+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/blog/comment.do"+c),type:"GET",async:false,dataType:"json",cache:false,success:function(e){if(e.online_num){$("#online").html(e.online_num+"人")}if(e.data[0]==3){lerDiv("请登录用户");return}if(e.data[0]==2){lerDiv("验证码错误");changeImg()}if(e.data[0]==1){lookContent(nowBlogIndex);changeImg()}},error:function(e){console.log(e)}})}function lerDiv(a){$("#warning").html('<div class="alert alert-warning" style=\'padding-top:5px;padding-bottom:5px;\'>\n    <a href="#" class="close" data-dismiss="alert">\n        &times;\n    </a>\n    <strong>'+a+"</strong></div>")}function displayComment(){$("#comments").slideToggle("slow")}function commentForm(){$("#commentform").slideToggle("slow")}function loadComments(){var a="?blogId="+dataOfNowPage[nowBlogIndex]+"&t="+Math.random();$.ajax({url:encodeURI("/blog2/message/queryComments.do"+a),type:"GET",async:false,dataType:"json",cache:false,success:function(c){var f=$("<div id='comments'></div>");var e=c.data;for(var d=0;d<c.total;++d){var b=$("<p data-scroll-reveal='enter right over 0.5s'></p>");b.append(adduser(e[d].username,e[d].userContent,e[d].content,e[d].addtime));f.append(b)}if(c.total==0){f.append('<p class="cons">还没有人来评论，赶快评论一下...</p>')}$("#center").append(f);$("#comments").slideToggle("slow");if(c.online_num){$("#online").html(c.online_num+"人")}},error:function(b){console.log(b)}})}function adduser(a,b,c,d){return'<img src="/blog2/static/img/user.png" style="height: 25px; width: 25px">\n                <span class="user"> '+a+' </span>\n                <span class="uContent"> &nbsp; -个性签名- ：'+b.replace(/&/g,"&amp").replace(/</g,"&lt").replace(/>/g,"&gt")+'</span><br/>\n                <p class="cons">'+c.replace(/&/g,"&amp").replace(/</g,"&lt").replace(/>/g,"&gt")+'&nbsp; &nbsp; &nbsp; &nbsp;\n                <span class="glyphicon glyphicon-time"></span>\n                <span class="commentTime"> '+longToTime(d)+"</span>\n                </p>"}function addbottom(c,a,b,d){return'<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-time"></span> &nbsp;'+longToTime(c)+'&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-tags"></span> &nbsp;'+a+'&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-eye-open"></span> &nbsp;'+b+'&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span> &nbsp;'+d+"</p>"}function addNextAndpre(){return"<ul class=\"pager\">\n\t<li class=\"previous\"><a onclick='pre()' href='#'>&larr; Older</a></li>\n\t<li class=\"center-block\"><a onclick='displayComment()'><label>用户评论</label></a></li>\n\t<li class=\"center-block\"><a onclick='commentForm()'><label>我要评论</label></a></li>\n\t<li class=\"next\"><a onclick='nex()' href='#'>Newer &rarr;</a></li>\n</ul>"}function pre(){nowBlogIndex--;var a=nowBlogIndex>=0?nowBlogIndex:maxrows-1;lookContent(a)}function nex(){nowBlogIndex++;var a=nowBlogIndex<maxrows?nowBlogIndex:0;lookContent(a)}function longToTime(b){var a=new Date(b);Y=a.getFullYear()+"-";M=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-";D=a.getDate()+" ";h=a.getHours()+":";m=a.getMinutes()+":";s=a.getSeconds();return Y+M+D+h+m+s}function ToTime(b){var a=new Date(b);Y=a.getFullYear()-1970;if(Y==0){Y=""}else{Y=Y+"年"}M=(a.getMonth()+1<10?(a.getMonth()+1):a.getMonth()+1)+"月";D=a.getDate()+"天 ";h=a.getHours()+":";m=a.getMinutes()+":";s=a.getSeconds();return Y+M+D+h+m+s}function reset(){var a={enter:"bottom",move:"40px",over:"0.16s",reset:false,init:true};scrollReveal.init()}(function(b){var a={init:function(d,c){return(function(){a.fillHtml(d,c);a.bindEvent(d,c)})()},fillHtml:function(d,c){return(function(){d="";if(c.currPage!=1&&c.currPage>=4&&c.totalPage!=4){d+="<li class='ali'><a href='javascript:void(0);' class='geraltTb_pager' data-go='' >"+1+"</a></li>"}if(c.currPage-2>2&&c.currPage<=c.totalPage&&c.totalPage>5){d+="<li class='ali'><a href='javascript:void(0);' class='geraltTb_' data-go='' >...</a></li>"}var f=c.currPage-2;var e=c.currPage+2;if((f>1&&c.currPage<4)||c.currPage==1){e++}if(c.currPage>c.totalPage-4&&c.currPage>=c.totalPage){f--}for(;f<=e;f++){if(f<=c.totalPage&&f>=1){if(f!=nowpag){d+="<li class='ali'><a href='javascript:void(0);' class='geraltTb_pager' data-go='' >"+f+"</a></li>"}else{d+="<li class='ali'><a href='javascript:void(0);' style='background-color: #F4F4F4' class='geraltTb_pager' data-go='' >"+f+"</a></li>"}}}if(c.currPage+2<c.totalPage-1&&c.currPage>=1&&c.totalPage>5){d+="<li class='ali'><a href='javascript:void(0);' class='geraltTb_' data-go='' >...</a></li>"}if(c.currPage!=c.totalPage&&c.currPage<c.totalPage-2&&c.totalPage!=4){d+="<li class='ali'><a href='javascript:void(0);' class='geraltTb_pager' data-go='' >"+c.totalPage+"</a></li>"}b(".pagination").html(d)})()},bindEvent:function(d,c){return(function(){d.on("click","a.geraltTb_pager",function(e){var f=parseInt(b(this).text());a.fillHtml(d,{currPage:f,totalPage:c.totalPage,turndown:c.turndown});if(typeof(c.backFn)=="function"){c.backFn(f)}})})()}};b.fn.createPage=function(c){a.init(this,c)}})(jQuery);